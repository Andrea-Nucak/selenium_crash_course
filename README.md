# qawa â˜•

`qawa` stands for `QA Web Automation.`

It is a `template project` using Selenium that will help you quickly start writing maintainable UI tests for your web projects.

## Setup

After cloning, navigate to the repo folder and do the following:

#### Venv
* `python3 -m venv venv`
* `source venv/bin/activate`

#### Dependencies
* `pip install -r requirements.txt`

#### Precommit hook
* `pre-commit install`

#### Drivers
Documentation and download links:

* [ChromeDriver](https://chromedriver.chromium.org/) (or `brew install chromedriver`)
* [geckodriver](https://github.com/mozilla/geckodriver/releases) (or `brew install geckodriver`)
* [safaridriver](https://developer.apple.com/documentation/webkit/testing_with_webdriver_in_safari) (you have to enable `Allow Remote Automation` in Safari's settings)
* [Microsoft Edge WebDriver](https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/) (extract the `msedgedriver` executable to `/usr/local/bin`)

## Project structure
This project uses the `page object pattern`.

It is structured into 2 main packages:

* `pages`
    * Contains page classes.
    * All page classes should inherit from `BasePage` which is defined in `base_page.py`.
* `tests`
    * Contains the tests themselves.

Pytest configuration files:

* `pytest.ini` is the primary pytest configuration file that allows you to change default behavior (e.g. the log level and report configurations).
* `conftest.py` is used to define fixtures which can be used by any test without needing to import them. pytest will automatically discover them.

Logging artifacts are stored in the following folders:

* `reports`
* `screenshots`

Dependencies can be found in the project root as:

* `requirements.txt`

## Minimum setup for running tests
1. Change `URLS` in `conftest.py`.
2. Change the `REPORT_NAME` in `conftest.py`.
3. Create a page object class extending `BasePage` in the `pages` package.
4. Create a test class in the `tests` package.
5. Run the test suite: `pytest`.

Examples of a page object class and a test class are provided.

## Test setup
In order to be automatically discovered by pytest's standard test discovery:
- All test methods need to be prefixed with `test_`.
- All test `.py` files need to be prefixed with `test_`: `test_*.py`.
- All test classes within `test_*.py` files need to be prefixed with `Test` (example: TestBlog).

Test methods within a test class should have the following parameters: `self`, `set_up`, `extra`.

Example: `def test_navigate_to_shameless_posts(self, set_up, extra)`
- `set_up` has to be defined as a pytest fixture at the beginning of each test class to initialize pages.
- `extra` is a predefined pytest fixture used to append data (e.g., images) to the HTML report. It has to be used within a test method only if the `save_screenshot` method is used.

## Interface for specifying options

- Chrome is the default browser, but here is the full list of supported browsers:
    * `pytest --browser=chrome`
    * `pytest --browser=chrome-headless`
    * `pytest --browser=firefox`
    * `pytest --browser=safari`
    * `pytest --browser=edge`

- The default environment is `dev`, buy you can specify a different one using the `env` argument:
    * `pytest --env=prod`

- You can create additional custom command-line arguments by adding them to the `pytest_addoption` hook in `conftest.py`.

- You can specify the test scope by adding the path of the scope you would like to run. You can run tests from specific directories or modules, an entire class or just one test:
    * `pytest tests/` - Directory
    * `pytest tests/test_blog.py` - Module
    * `pytest tests/test_blog.py::TestBlog` - Test class
    * `pytest tests/test_blog.py::TestBlog::test_navigate_to_blog_page` - Test method

- You can use markers to mark a test function with custom metadata, e.g., when you want to specify regression and smoke test suites. Examples are provided in `test_blog.py`:
    * `pytest -m=regression`
    * `pytest -m=smoke`

Note: HTML reports are generated by default as defined in the `pytest.ini` file.

## CircleCI setup
- See `circleci/config.yml`.
- The default config runs all tests on every push to any branch and nightly.
- It runs the following command: `python3 -m pytest`.
- The latest stable versions of Chrome, ChromeDriver, Firefox and GeckoDriver are installed by running the `browser-tools/install-browser-tools` command in the job's steps (alongside the `browser-tools` orb).
- The `browser-tools` orb is meant to pair with the `-browser` variants of the `cimg/python` Docker images created by CircleCI.
